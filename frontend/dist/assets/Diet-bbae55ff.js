import{L as G}from"./Layout-cffebef8.js";import{a as J,r as b,v as R,i as K,c as s,x as Q,o as B,j as I,w as t,E as c,e as r,f as e,k as W,s as X,h as _,t as u,y as Y,z as Z}from"./index-fedfb087.js";import{a as ee,b as te,d as le}from"./diet-5bd19ab0.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";const oe={class:"diet-page"},ne={style:{"background-color":"transparent",padding:"20px"}},se={style:{"background-color":"transparent",padding:"20px"}},re={class:"header-actions"},ie={style:{"background-color":"transparent",padding:"20px"}},ue={class:"nutrition-item"},de={class:"nutrition-value"},ce={class:"nutrition-item"},_e={class:"nutrition-value"},pe={class:"nutrition-item"},fe={class:"nutrition-value"},me={class:"nutrition-item"},ve={class:"nutrition-value"},ge={__name:"Diet",setup(ye){const m=J(),o=b({foodName:"",calories:0,quantity:1,mealType:"",time:null}),v=b([]),w=b(!1),h=b(!1),L=R(()=>v.value.reduce((a,l)=>a+l.calories,0)),k=async()=>{if(!m.userId){c.error("请先登录");return}h.value=!0;try{const a=await ee(m.userId,{limit:30});v.value=a.data||[]}catch(a){c.error(a.message||"获取饮食记录失败")}finally{h.value=!1}},M=async()=>{if(!m.userId){c.error("请先登录");return}if(!o.value.foodName||!o.value.calories||!o.value.mealType){c.warning("请填写完整的饮食信息");return}w.value=!0;try{const a={user_id:m.userId,meal_type:o.value.mealType,content:o.value.foodName,calories:o.value.calories,date:new Date().toISOString().split("T")[0]};await te(a),o.value={foodName:"",calories:0,quantity:1,mealType:"",time:null},c.success("饮食记录添加成功"),await k()}catch(a){c.error(a.message||"添加饮食记录失败")}finally{w.value=!1}},S=async a=>{try{await Z.confirm("确定要删除这条饮食记录吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await le(a),c.success("记录删除成功"),await k()}catch(l){l!=="cancel"&&c.error(l.message||"删除记录失败")}},d=R(()=>({protein:45,carbs:120,fat:35,fiber:15,proteinPercent:75,carbsPercent:60,fatPercent:70,fiberPercent:50})),U=a=>({breakfast:"success",lunch:"warning",dinner:"danger",snack:"info"})[a]||"info",q=a=>({breakfast:"早餐",lunch:"午餐",dinner:"晚餐",snack:"加餐"})[a]||a,z=a=>a?new Date(a).toLocaleDateString("zh-CN"):"-";return K(()=>{k()}),(a,l)=>{const E=s("el-input"),p=s("el-form-item"),i=s("el-col"),C=s("el-input-number"),x=s("el-row"),g=s("el-option"),H=s("el-select"),j=s("el-time-picker"),A=s("el-icon"),P=s("el-button"),F=s("el-form"),V=s("a-card"),D=s("a-col"),T=s("a-row"),N=s("el-tag"),f=s("el-table-column"),O=s("el-table"),y=s("el-progress"),$=Q("loading");return B(),I(G,null,{default:t(()=>[r("div",oe,[r("div",ne,[e(T,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(D,{span:24},{default:t(()=>[e(V,{title:"添加饮食记录",style:{height:"100%"}},{default:t(()=>[e(F,{model:o.value,"label-width":"100px"},{default:t(()=>[e(x,{gutter:20},{default:t(()=>[e(i,{span:8},{default:t(()=>[e(p,{label:"食物名称"},{default:t(()=>[e(E,{modelValue:o.value.foodName,"onUpdate:modelValue":l[0]||(l[0]=n=>o.value.foodName=n),placeholder:"请输入食物名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:8},{default:t(()=>[e(p,{label:"卡路里"},{default:t(()=>[e(C,{modelValue:o.value.calories,"onUpdate:modelValue":l[1]||(l[1]=n=>o.value.calories=n),min:0,max:5e3,placeholder:"卡路里"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:8},{default:t(()=>[e(p,{label:"份量"},{default:t(()=>[e(C,{modelValue:o.value.quantity,"onUpdate:modelValue":l[2]||(l[2]=n=>o.value.quantity=n),min:.1,max:10,precision:1,placeholder:"份量"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(x,{gutter:20},{default:t(()=>[e(i,{span:8},{default:t(()=>[e(p,{label:"餐次"},{default:t(()=>[e(H,{modelValue:o.value.mealType,"onUpdate:modelValue":l[3]||(l[3]=n=>o.value.mealType=n),placeholder:"选择餐次"},{default:t(()=>[e(g,{label:"早餐",value:"breakfast"}),e(g,{label:"午餐",value:"lunch"}),e(g,{label:"晚餐",value:"dinner"}),e(g,{label:"加餐",value:"snack"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{span:8},{default:t(()=>[e(p,{label:"时间"},{default:t(()=>[e(j,{modelValue:o.value.time,"onUpdate:modelValue":l[4]||(l[4]=n=>o.value.time=n),placeholder:"选择时间",format:"HH:mm"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:8},{default:t(()=>[e(p,null,{default:t(()=>[e(P,{type:"primary",onClick:M,loading:w.value},{default:t(()=>[e(A,null,{default:t(()=>[e(W(X))]),_:1}),l[5]||(l[5]=_(" 添加记录 ",-1))]),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),r("div",se,[e(T,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(D,{span:24},{default:t(()=>[e(V,{title:"今日饮食记录",style:{height:"100%"}},{default:t(()=>[r("div",re,[e(N,{type:"success"},{default:t(()=>[_("总卡路里: "+u(L.value)+" kcal",1)]),_:1}),e(N,{type:"info"},{default:t(()=>[_("记录数: "+u(v.value.length),1)]),_:1})]),Y((B(),I(O,{data:v.value,style:{width:"100%"}},{default:t(()=>[e(f,{prop:"content",label:"食物名称"}),e(f,{prop:"calories",label:"卡路里",width:"100"},{default:t(n=>[_(u(n.row.calories)+" kcal ",1)]),_:1}),e(f,{prop:"meal_type",label:"餐次",width:"100"},{default:t(n=>[e(N,{type:U(n.row.meal_type)},{default:t(()=>[_(u(q(n.row.meal_type)),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"date",label:"日期",width:"120"},{default:t(n=>[_(u(z(n.row.date)),1)]),_:1}),e(f,{label:"操作",width:"120"},{default:t(n=>[e(P,{type:"danger",size:"small",onClick:be=>S(n.row.id)},{default:t(()=>l[6]||(l[6]=[_(" 删除 ",-1)])),_:2,__:[6]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[$,h.value]])]),_:1})]),_:1})]),_:1})]),r("div",ie,[e(T,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(D,{span:24},{default:t(()=>[e(V,{title:"营养分析",style:{height:"100%"}},{default:t(()=>[e(x,{gutter:20},{default:t(()=>[e(i,{span:6},{default:t(()=>[r("div",ue,[l[7]||(l[7]=r("div",{class:"nutrition-label"},"蛋白质",-1)),r("div",de,u(d.value.protein)+"g",1),e(y,{percentage:d.value.proteinPercent},null,8,["percentage"])])]),_:1}),e(i,{span:6},{default:t(()=>[r("div",ce,[l[8]||(l[8]=r("div",{class:"nutrition-label"},"碳水化合物",-1)),r("div",_e,u(d.value.carbs)+"g",1),e(y,{percentage:d.value.carbsPercent},null,8,["percentage"])])]),_:1}),e(i,{span:6},{default:t(()=>[r("div",pe,[l[9]||(l[9]=r("div",{class:"nutrition-label"},"脂肪",-1)),r("div",fe,u(d.value.fat)+"g",1),e(y,{percentage:d.value.fatPercent},null,8,["percentage"])])]),_:1}),e(i,{span:6},{default:t(()=>[r("div",me,[l[10]||(l[10]=r("div",{class:"nutrition-label"},"纤维",-1)),r("div",ve,u(d.value.fiber)+"g",1),e(y,{percentage:d.value.fiberPercent},null,8,["percentage"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1})}}},Ve=ae(ge,[["__scopeId","data-v-6e885ffb"]]);export{Ve as default};
