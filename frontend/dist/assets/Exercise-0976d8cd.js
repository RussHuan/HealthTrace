import{L as X}from"./Layout-cffebef8.js";import{a as Z,r as y,v as B,i as ee,c as n,x as te,o as I,j as L,w as t,E as u,e as o,f as e,k,s as le,h as d,t as r,y as ae,B as oe,C as se,D as ie,F as ne,z as re}from"./index-fedfb087.js";import{a as de,g as ue,b as ce,d as pe}from"./exercise-108ce67f.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";const me={class:"exercise-page"},_e={style:{"background-color":"transparent",padding:"20px"}},we={style:{"background-color":"transparent",padding:"20px"}},he={class:"header-actions"},ge={style:{"background-color":"transparent",padding:"20px"}},ve={style:{display:"flex","align-items":"center",width:"100%","min-width":"0"}},ye={style:{"font-size":"32px",color:"#1890ff","margin-right":"12px","flex-shrink":"0"}},xe={style:{display:"flex","flex-direction":"column",overflow:"hidden","min-width":"0"}},be={style:{margin:"0","font-weight":"bold","font-size":"26px","line-height":"1.4","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},ke={style:{display:"flex","align-items":"center",width:"100%","min-width":"0"}},Ye={style:{"font-size":"32px",color:"#1890ff","margin-right":"12px","flex-shrink":"0"}},De={style:{display:"flex","flex-direction":"column",overflow:"hidden","min-width":"0"}},Ve={style:{margin:"0","font-weight":"bold","font-size":"26px","line-height":"1.4","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Te={style:{display:"flex","align-items":"center",width:"100%","min-width":"0"}},ze={style:{"font-size":"32px",color:"#1890ff","margin-right":"12px","flex-shrink":"0"}},Ee={style:{display:"flex","flex-direction":"column",overflow:"hidden","min-width":"0"}},Me={style:{margin:"0","font-weight":"bold","font-size":"26px","line-height":"1.4","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ce={style:{display:"flex","align-items":"center",width:"100%","min-width":"0"}},Re={style:{"font-size":"32px",color:"#1890ff","margin-right":"12px","flex-shrink":"0"}},He={style:{display:"flex","flex-direction":"column",overflow:"hidden","min-width":"0"}},Be={style:{margin:"0","font-weight":"bold","font-size":"26px","line-height":"1.4","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ie={style:{margin:"0",color:"#888","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Le={__name:"Exercise",setup(Se){const m=Z(),i=y({type:"",startTime:null,endTime:null,calories:0,notes:""}),x=y([]),c=y({}),V=y(!1),T=y(!1),_=y([]),S=B(()=>x.value.reduce((a,l)=>a+(l.duration_mimutes||0),0)),U=B(()=>x.value.reduce((a,l)=>a+(l.calories||0),0)),Y=async()=>{if(!m.userId){u.error("请先登录");return}T.value=!0;try{const a={};_.value&&_.value.length===2&&(a.start_date=_.value[0],a.end_date=_.value[1]);const l=await de(m.userId,a);x.value=l.data||[]}catch(a){u.error(a.message||"加载运动记录失败")}finally{T.value=!1}},z=async()=>{if(m.userId)try{const a=await ue(m.userId,7);c.value=a.data||{}}catch(a){console.error("加载运动统计失败:",a)}},N=async()=>{if(!m.userId){u.error("请先登录");return}if(!i.value.type||!i.value.startTime||!i.value.endTime){u.warning("请填写完整的运动信息");return}V.value=!0;try{const a={user_id:m.userId,type:i.value.type,start_time:i.value.startTime,end_time:i.value.endTime,calories:i.value.calories,notes:i.value.notes||""};await ce(a),i.value={type:"",startTime:null,endTime:null,calories:0,notes:""},u.success("运动记录添加成功"),await Y(),await z()}catch(a){u.error(a.message||"添加运动记录失败")}finally{V.value=!1}},$=a=>{u.info("编辑功能开发中...")},F=async a=>{try{await re.confirm("确定要删除这条运动记录吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe(a),u.success("运动记录删除成功"),await Y(),await z()}catch(l){l!=="cancel"&&u.error(l.message||"删除运动记录失败")}},R=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",j=a=>a?new Date(a).toLocaleDateString("zh-CN"):"-",A=a=>({running:"danger",walking:"success",cycling:"warning",swimming:"info",gym:"primary",yoga:"success",other:"info"})[a]||"info",q=a=>({running:"跑步",walking:"步行",cycling:"骑行",swimming:"游泳",gym:"健身",yoga:"瑜伽",other:"其他"})[a]||a;return ee(async()=>{await Y(),await z()}),(a,l)=>{const p=n("el-option"),G=n("el-select"),w=n("el-form-item"),h=n("el-col"),E=n("el-date-picker"),H=n("el-row"),J=n("el-input-number"),K=n("el-input"),b=n("el-icon"),M=n("el-button"),O=n("el-form"),g=n("a-card"),v=n("a-col"),C=n("a-row"),D=n("el-tag"),f=n("el-table-column"),P=n("el-table"),Q=te("loading");return I(),L(X,null,{default:t(()=>[o("div",me,[o("div",_e,[e(C,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(v,{span:24},{default:t(()=>[e(g,{title:"添加运动记录",style:{height:"100%"}},{default:t(()=>[e(O,{model:i.value,"label-width":"100px"},{default:t(()=>[e(H,{gutter:20},{default:t(()=>[e(h,{span:8},{default:t(()=>[e(w,{label:"运动类型"},{default:t(()=>[e(G,{modelValue:i.value.type,"onUpdate:modelValue":l[0]||(l[0]=s=>i.value.type=s),placeholder:"选择运动类型"},{default:t(()=>[e(p,{label:"跑步",value:"running"}),e(p,{label:"步行",value:"walking"}),e(p,{label:"骑行",value:"cycling"}),e(p,{label:"游泳",value:"swimming"}),e(p,{label:"健身",value:"gym"}),e(p,{label:"瑜伽",value:"yoga"}),e(p,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(h,{span:8},{default:t(()=>[e(w,{label:"开始时间"},{default:t(()=>[e(E,{modelValue:i.value.startTime,"onUpdate:modelValue":l[1]||(l[1]=s=>i.value.startTime=s),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:8},{default:t(()=>[e(w,{label:"结束时间"},{default:t(()=>[e(E,{modelValue:i.value.endTime,"onUpdate:modelValue":l[2]||(l[2]=s=>i.value.endTime=s),type:"datetime",placeholder:"选择结束时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(H,{gutter:20},{default:t(()=>[e(h,{span:8},{default:t(()=>[e(w,{label:"消耗卡路里"},{default:t(()=>[e(J,{modelValue:i.value.calories,"onUpdate:modelValue":l[3]||(l[3]=s=>i.value.calories=s),min:0,max:2e3,placeholder:"卡路里"},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:8},{default:t(()=>[e(w,{label:"备注"},{default:t(()=>[e(K,{modelValue:i.value.notes,"onUpdate:modelValue":l[4]||(l[4]=s=>i.value.notes=s),placeholder:"添加备注信息（可选）"},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:8},{default:t(()=>[e(w,null,{default:t(()=>[e(M,{type:"primary",onClick:N,loading:V.value},{default:t(()=>[e(b,null,{default:t(()=>[e(k(le))]),_:1}),l[6]||(l[6]=d(" 添加记录 ",-1))]),_:1,__:[6]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),o("div",we,[e(C,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(v,{span:24},{default:t(()=>[e(g,{title:"运动记录列表",style:{height:"100%"}},{default:t(()=>[o("div",he,[e(E,{modelValue:_.value,"onUpdate:modelValue":l[5]||(l[5]=s=>_.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:Y,style:{"margin-right":"10px"}},null,8,["modelValue"]),e(D,{type:"success"},{default:t(()=>[d("总时长: "+r(S.value)+" 分钟",1)]),_:1}),e(D,{type:"warning"},{default:t(()=>[d("消耗: "+r(U.value)+" kcal",1)]),_:1}),e(D,{type:"info"},{default:t(()=>[d("记录数: "+r(x.value.length),1)]),_:1})]),ae((I(),L(P,{data:x.value,style:{width:"100%"}},{default:t(()=>[e(f,{prop:"type",label:"运动类型",width:"120"},{default:t(s=>[e(D,{type:A(s.row.type)},{default:t(()=>[d(r(q(s.row.type)),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"start_time",label:"开始时间",width:"160"},{default:t(s=>[d(r(R(s.row.start_time)),1)]),_:1}),e(f,{prop:"end_time",label:"结束时间",width:"160"},{default:t(s=>[d(r(R(s.row.end_time)),1)]),_:1}),e(f,{prop:"duration_mimutes",label:"时长",width:"100"},{default:t(s=>[d(r(s.row.duration_mimutes)+" 分钟 ",1)]),_:1}),e(f,{prop:"calories",label:"消耗卡路里",width:"120"},{default:t(s=>[d(r(s.row.calories)+" kcal ",1)]),_:1}),e(f,{prop:"notes",label:"备注","min-width":"200"},{default:t(s=>[d(r(s.row.notes||"-"),1)]),_:1}),e(f,{label:"操作",width:"150"},{default:t(s=>[e(M,{type:"primary",size:"small",onClick:W=>$(s.row)},{default:t(()=>l[7]||(l[7]=[d(" 编辑 ",-1)])),_:2,__:[7]},1032,["onClick"]),e(M,{type:"danger",size:"small",onClick:W=>F(s.row.id)},{default:t(()=>l[8]||(l[8]=[d(" 删除 ",-1)])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,T.value]])]),_:1})]),_:1})]),_:1})]),o("div",ge,[e(C,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(v,{xs:24,sm:12,md:6,style:{height:"140px"}},{default:t(()=>[e(g,{bordered:!1,style:{height:"100%",display:"flex","align-items":"center","min-width":"0"}},{default:t(()=>[o("div",ve,[o("div",ye,[e(b,null,{default:t(()=>[e(k(oe))]),_:1})]),o("div",xe,[l[9]||(l[9]=o("h3",{style:{margin:"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 平均运动时长 ",-1)),o("p",be,r(c.value.average_duration||0)+" 分钟 ",1),l[10]||(l[10]=o("p",{style:{margin:"0",color:"#888","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 目标: 30 分钟 ",-1))])])]),_:1})]),_:1}),e(v,{xs:0,sm:12,md:6,style:{height:"140px"},class:"hide-xs"},{default:t(()=>[e(g,{bordered:!1,style:{height:"100%",display:"flex","align-items":"center","min-width":"0"}},{default:t(()=>[o("div",ke,[o("div",Ye,[e(b,null,{default:t(()=>[e(k(se))]),_:1})]),o("div",De,[l[11]||(l[11]=o("h3",{style:{margin:"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 总消耗卡路里 ",-1)),o("p",Ve,r(c.value.total_calories||0)+" kcal ",1),l[12]||(l[12]=o("p",{style:{margin:"0",color:"#888","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 目标: 1000 kcal ",-1))])])]),_:1})]),_:1}),e(v,{xs:0,sm:0,md:6,style:{height:"140px"},class:"hide-sm-xs"},{default:t(()=>[e(g,{bordered:!1,style:{height:"100%",display:"flex","align-items":"center","min-width":"0"}},{default:t(()=>[o("div",Te,[o("div",ze,[e(b,null,{default:t(()=>[e(k(ie))]),_:1})]),o("div",Ee,[l[13]||(l[13]=o("h3",{style:{margin:"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 记录总数 ",-1)),o("p",Me,r(c.value.total_records||0)+" 条 ",1),l[14]||(l[14]=o("p",{style:{margin:"0",color:"#888","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 最近7天 ",-1))])])]),_:1})]),_:1}),e(v,{xs:0,sm:0,md:6,style:{height:"140px"},class:"hide-sm-xs"},{default:t(()=>[e(g,{bordered:!1,style:{height:"100%",display:"flex","align-items":"center","min-width":"0"}},{default:t(()=>[o("div",Ce,[o("div",Re,[e(b,null,{default:t(()=>[e(k(ne))]),_:1})]),o("div",He,[l[15]||(l[15]=o("h3",{style:{margin:"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 最佳运动 ",-1)),o("p",Be,r(c.value.best_exercise?c.value.best_exercise.calories:0)+" kcal ",1),o("p",Ie,r(c.value.best_exercise?j(c.value.best_exercise.start_time):"暂无"),1)])])]),_:1})]),_:1})]),_:1})])])]),_:1})}}},je=fe(Le,[["__scopeId","data-v-7485cf8f"]]);export{je as default};
