import{L as ee}from"./Layout-cffebef8.js";import{a as te,g as le,b as oe,d as ae}from"./sleep-4a39f951.js";import{a as se,r as y,v as U,i as ie,c as i,x as ne,o as D,j as S,w as t,E as u,e as a,f as e,k as L,s as re,h as p,t as r,y as de,n as ue,d as pe,G as ce,H as _e,z as fe}from"./index-fedfb087.js";import{_ as me}from"./_plugin-vue_export-helper-c27b6911.js";const he={class:"sleep-page"},we={style:{"background-color":"transparent",padding:"20px"}},ge={style:{"background-color":"transparent",padding:"20px"}},ye={class:"header-actions"},ve={style:{"background-color":"transparent",padding:"20px"}},xe={style:{display:"flex","align-items":"center",width:"100%","min-width":"0"}},be={style:{"font-size":"32px",color:"#1890ff","margin-right":"12px","flex-shrink":"0"}},ke={style:{display:"flex","flex-direction":"column",overflow:"hidden","min-width":"0"}},De={style:{margin:"0","font-weight":"bold","font-size":"26px","line-height":"1.4","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ye={style:{display:"flex","align-items":"center",width:"100%","min-width":"0"}},Ve={style:{"font-size":"32px",color:"#1890ff","margin-right":"12px","flex-shrink":"0"}},Se={style:{display:"flex","flex-direction":"column",overflow:"hidden","min-width":"0"}},Te={style:{margin:"0","font-weight":"bold","font-size":"26px","line-height":"1.4","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},ze={style:{display:"flex","align-items":"center",width:"100%","min-width":"0"}},Me={style:{"font-size":"32px",color:"#1890ff","margin-right":"12px","flex-shrink":"0"}},Re={style:{display:"flex","flex-direction":"column",overflow:"hidden","min-width":"0"}},Ce={style:{margin:"0","font-weight":"bold","font-size":"26px","line-height":"1.4","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},qe={style:{display:"flex","align-items":"center",width:"100%","min-width":"0"}},He={style:{"font-size":"32px",color:"#1890ff","margin-right":"12px","flex-shrink":"0"}},Be={style:{display:"flex","flex-direction":"column",overflow:"hidden","min-width":"0"}},Ie={style:{margin:"0","font-weight":"bold","font-size":"26px","line-height":"1.4","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ue={style:{margin:"0",color:"#888","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Le={style:{"background-color":"transparent",padding:"20px"}},Ne={class:"advice-content"},Ee={__name:"Sleep",setup(Fe){const m=se(),n=y({sleepTime:null,wakeTime:null,qualityRating:5,notes:""}),h=y([]),d=y({}),T=y(!1),z=y(!1),w=y([]),N=U(()=>h.value.length===0?0:(h.value.reduce((l,c)=>l+c.duration_hours,0)/h.value.length).toFixed(1)),q=U(()=>{const o=[],l=d.value.average_duration||0,c=d.value.average_quality||0;return l<7?o.push({title:"睡眠时长不足",description:"您的平均睡眠时长低于推荐标准，建议保持7-9小时睡眠以获得最佳休息效果。",type:"warning"}):l>9?o.push({title:"睡眠时长过长",description:"您的睡眠时长可能过长，建议控制在7-9小时范围内。",type:"info"}):o.push({title:"睡眠时长良好",description:"您的睡眠时长在健康范围内，继续保持！",type:"success"}),c<6?o.push({title:"睡眠质量待改善",description:"您的睡眠质量评分较低，建议改善睡眠环境和习惯。",type:"warning"}):c>=8&&o.push({title:"睡眠质量优秀",description:"您的睡眠质量很好，继续保持良好的睡眠习惯！",type:"success"}),o}),H=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",E=o=>o?new Date(o).toLocaleDateString("zh-CN"):"-",F=o=>o>=7&&o<=9?"success":o>=6&&o<7?"warning":o>9?"info":"danger",Y=async()=>{if(!m.userId){u.error("请先登录");return}z.value=!0;try{const o={};w.value&&w.value.length===2&&(o.start_date=w.value[0],o.end_date=w.value[1]);const l=await te(m.userId,o);h.value=l.data||[]}catch(o){u.error(o.message||"加载睡眠记录失败")}finally{z.value=!1}},M=async()=>{if(m.userId)try{const o=await le(m.userId,7);d.value=o.data||{}}catch(o){console.error("加载睡眠统计失败:",o)}},$=async()=>{if(!m.userId){u.error("请先登录");return}if(!n.value.sleepTime||!n.value.wakeTime){u.warning("请填写完整的睡眠信息");return}T.value=!0;try{const o={user_id:m.userId,sleep_time:n.value.sleepTime,wake_time:n.value.wakeTime,quality_rating:n.value.qualityRating,notes:n.value.notes||""};await oe(o),n.value={sleepTime:null,wakeTime:null,qualityRating:5,notes:""},u.success("睡眠记录添加成功"),await Y(),await M()}catch(o){u.error(o.message||"添加睡眠记录失败")}finally{T.value=!1}},A=o=>{u.info("编辑功能开发中...")},j=async o=>{try{await fe.confirm("确定要删除这条睡眠记录吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ae(o),u.success("睡眠记录删除成功"),await Y(),await M()}catch(l){l!=="cancel"&&u.error(l.message||"删除睡眠记录失败")}};return ie(async()=>{await Y(),await M()}),(o,l)=>{const c=i("el-date-picker"),v=i("el-form-item"),x=i("el-col"),B=i("el-rate"),I=i("el-row"),G=i("el-input"),b=i("el-icon"),R=i("el-button"),Q=i("el-form"),_=i("a-card"),f=i("a-col"),V=i("a-row"),C=i("el-tag"),g=i("el-table-column"),J=i("el-table"),K=i("Star"),O=i("Timer"),P=i("Calendar"),W=i("el-alert"),X=i("el-empty"),Z=ne("loading");return D(),S(ee,null,{default:t(()=>[a("div",he,[a("div",we,[e(V,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(f,{span:24},{default:t(()=>[e(_,{title:"添加睡眠记录",style:{height:"100%"}},{default:t(()=>[e(Q,{model:n.value,"label-width":"100px"},{default:t(()=>[e(I,{gutter:20},{default:t(()=>[e(x,{span:8},{default:t(()=>[e(v,{label:"入睡时间"},{default:t(()=>[e(c,{modelValue:n.value.sleepTime,"onUpdate:modelValue":l[0]||(l[0]=s=>n.value.sleepTime=s),type:"datetime",placeholder:"选择入睡时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{span:8},{default:t(()=>[e(v,{label:"起床时间"},{default:t(()=>[e(c,{modelValue:n.value.wakeTime,"onUpdate:modelValue":l[1]||(l[1]=s=>n.value.wakeTime=s),type:"datetime",placeholder:"选择起床时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DDTHH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{span:8},{default:t(()=>[e(v,{label:"睡眠质量"},{default:t(()=>[e(B,{modelValue:n.value.qualityRating,"onUpdate:modelValue":l[2]||(l[2]=s=>n.value.qualityRating=s),max:10,"show-score":"",texts:["很差","差","一般","良好","很好","优秀","极好","完美","卓越","理想"]},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,{gutter:20},{default:t(()=>[e(x,{span:16},{default:t(()=>[e(v,{label:"备注"},{default:t(()=>[e(G,{modelValue:n.value.notes,"onUpdate:modelValue":l[3]||(l[3]=s=>n.value.notes=s),type:"textarea",placeholder:"添加备注信息（可选）",rows:2},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{span:8},{default:t(()=>[e(v,null,{default:t(()=>[e(R,{type:"primary",onClick:$,loading:T.value},{default:t(()=>[e(b,null,{default:t(()=>[e(L(re))]),_:1}),l[5]||(l[5]=p(" 添加记录 ",-1))]),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),a("div",ge,[e(V,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(f,{span:24},{default:t(()=>[e(_,{title:"睡眠记录列表",style:{height:"100%"}},{default:t(()=>[a("div",ye,[e(c,{modelValue:w.value,"onUpdate:modelValue":l[4]||(l[4]=s=>w.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:Y,style:{"margin-right":"10px"}},null,8,["modelValue"]),e(C,{type:"success"},{default:t(()=>[p("平均时长: "+r(N.value)+" 小时",1)]),_:1}),e(C,{type:"info"},{default:t(()=>[p("记录数: "+r(h.value.length),1)]),_:1})]),de((D(),S(J,{data:h.value,style:{width:"100%"}},{default:t(()=>[e(g,{prop:"sleep_time",label:"入睡时间",width:"160"},{default:t(s=>[p(r(H(s.row.sleep_time)),1)]),_:1}),e(g,{prop:"wake_time",label:"起床时间",width:"160"},{default:t(s=>[p(r(H(s.row.wake_time)),1)]),_:1}),e(g,{prop:"duration_hours",label:"睡眠时长",width:"120"},{default:t(s=>[e(C,{type:F(s.row.duration_hours)},{default:t(()=>[p(r(s.row.duration_hours)+" 小时 ",1)]),_:2},1032,["type"])]),_:1}),e(g,{prop:"quality_rating",label:"睡眠质量",width:"120"},{default:t(s=>[e(B,{modelValue:s.row.quality_rating,"onUpdate:modelValue":k=>s.row.quality_rating=k,max:10,disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(g,{prop:"notes",label:"备注","min-width":"200"},{default:t(s=>[p(r(s.row.notes||"-"),1)]),_:1}),e(g,{label:"操作",width:"150"},{default:t(s=>[e(R,{type:"primary",size:"small",onClick:k=>A(s.row)},{default:t(()=>l[6]||(l[6]=[p(" 编辑 ",-1)])),_:2,__:[6]},1032,["onClick"]),e(R,{type:"danger",size:"small",onClick:k=>j(s.row.id)},{default:t(()=>l[7]||(l[7]=[p(" 删除 ",-1)])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,z.value]])]),_:1})]),_:1})]),_:1})]),a("div",ve,[e(V,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(f,{xs:24,sm:12,md:6,style:{height:"140px"}},{default:t(()=>[e(_,{bordered:!1,style:{height:"100%",display:"flex","align-items":"center","min-width":"0"}},{default:t(()=>[a("div",xe,[a("div",be,[e(b,null,{default:t(()=>[e(L(ue))]),_:1})]),a("div",ke,[l[8]||(l[8]=a("h3",{style:{margin:"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 平均睡眠时长 ",-1)),a("p",De,r(d.value.average_duration||0)+" 小时 ",1),l[9]||(l[9]=a("p",{style:{margin:"0",color:"#888","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 目标: 8 小时 ",-1))])])]),_:1})]),_:1}),e(f,{xs:0,sm:12,md:6,style:{height:"140px"},class:"hide-xs"},{default:t(()=>[e(_,{bordered:!1,style:{height:"100%",display:"flex","align-items":"center","min-width":"0"}},{default:t(()=>[a("div",Ye,[a("div",Ve,[e(b,null,{default:t(()=>[e(K)]),_:1})]),a("div",Se,[l[10]||(l[10]=a("h3",{style:{margin:"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 平均睡眠质量 ",-1)),a("p",Te,r(d.value.average_quality||0)+"/10 ",1),l[11]||(l[11]=a("p",{style:{margin:"0",color:"#888","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 目标: 8/10 ",-1))])])]),_:1})]),_:1}),e(f,{xs:0,sm:0,md:6,style:{height:"140px"},class:"hide-sm-xs"},{default:t(()=>[e(_,{bordered:!1,style:{height:"100%",display:"flex","align-items":"center","min-width":"0"}},{default:t(()=>[a("div",ze,[a("div",Me,[e(b,null,{default:t(()=>[e(O)]),_:1})]),a("div",Re,[l[12]||(l[12]=a("h3",{style:{margin:"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 记录总数 ",-1)),a("p",Ce,r(d.value.total_records||0)+" 条 ",1),l[13]||(l[13]=a("p",{style:{margin:"0",color:"#888","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 最近7天 ",-1))])])]),_:1})]),_:1}),e(f,{xs:0,sm:0,md:6,style:{height:"140px"},class:"hide-sm-xs"},{default:t(()=>[e(_,{bordered:!1,style:{height:"100%",display:"flex","align-items":"center","min-width":"0"}},{default:t(()=>[a("div",qe,[a("div",He,[e(b,null,{default:t(()=>[e(P)]),_:1})]),a("div",Be,[l[14]||(l[14]=a("h3",{style:{margin:"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}}," 最佳睡眠 ",-1)),a("p",Ie,r(d.value.best_sleep?d.value.best_sleep.duration_hours:0)+" 小时 ",1),a("p",Ue,r(d.value.best_sleep?E(d.value.best_sleep.sleep_time):"暂无"),1)])])]),_:1})]),_:1})]),_:1})]),a("div",Le,[e(V,{gutter:16,style:{display:"flex"}},{default:t(()=>[e(f,{span:24},{default:t(()=>[e(_,{title:"睡眠建议",style:{height:"100%"}},{default:t(()=>[a("div",Ne,[q.value.length>0?(D(!0),pe(_e,{key:0},ce(q.value,(s,k)=>(D(),S(W,{key:k,title:s.title,description:s.description,type:s.type,"show-icon":"",closable:!1,class:"advice-item"},null,8,["title","description","type"]))),128)):(D(),S(X,{key:1,description:"暂无睡眠建议"}))])]),_:1})]),_:1})]),_:1})])])]),_:1})}}},Qe=me(Ee,[["__scopeId","data-v-49266984"]]);export{Qe as default};
